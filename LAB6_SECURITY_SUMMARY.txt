===========================================
LAB 6: Jakarta Security API - PODSUMOWANIE
===========================================

âœ… WYKONANE ZADANIA:

1. âœ… Konfiguracja domeny bezpieczeÅ„stwa (0.5 + 0.5 pkt)
   - Basic Authentication z bazÄ… danych
   - DatabaseIdentityStore pobiera uÅ¼ytkownikÃ³w z bazy
   - **PBKDF2 Password Hashing** (210000 iteracji, SHA256)
   - PasswordHashProducer - centralna konfiguracja hashowania

2. âœ… Konfiguracja autoryzacji (1 + 1 pkt)
   - Role: ADMIN i USER
   - @RolesAllowed i @PermitAll na kontrolerach
   - Automatyczne ustawienie wÅ‚aÅ›ciciela notatki
   - Filtrowanie na poziomie bazy danych (JPQL)

===========================================
STRUKTURA PLIKÃ“W:
===========================================

NOWE PLIKI:
-----------
ğŸ“ src/main/java/pl/edu/pg/eti/kask/historyapi/security/
  â”œâ”€â”€ DatabaseIdentityStore.java       - Uwierzytelnianie z bazy + PBKDF2
  â”œâ”€â”€ SecurityConfig.java               - Basic Auth configuration
  â””â”€â”€ PasswordHashProducer.java         - CDI Producer dla Pbkdf2PasswordHash

ğŸ“ src/main/java/pl/edu/pg/eti/kask/historyapi/user/dto/
  â””â”€â”€ UserRegistrationDto.java          - DTO dla rejestracji

ZMODYFIKOWANE PLIKI:
--------------------
âœï¸  src/main/liberty/config/server.xml
    - Dodano <feature>appSecurity-5.0</feature>

âœï¸  DataInitializer.java
    - Dodano uÅ¼ytkownikÃ³w z rolami (ADMIN, USER)
    - admin / admin123 (ADMIN)
    - test / password123 (USER)

âœï¸  HistoricalFigureController.java
    - @PermitAll na GET
    - @RolesAllowed("ADMIN") na POST/PUT/DELETE

âœï¸  NoteController.java
    - @RolesAllowed({"ADMIN", "USER"}) na wszystkich metodach
    - Automatyczne ustawienie wÅ‚aÅ›ciciela w POST
    - Filtrowanie wynikÃ³w wedÅ‚ug uÅ¼ytkownika
    - Sprawdzanie wÅ‚aÅ›ciciela w PUT/DELETE

âœï¸  NoteSimpleController.java
    - @RolesAllowed({"ADMIN", "USER"})
    - Filtrowanie wynikÃ³w wedÅ‚ug uÅ¼ytkownika

âœï¸  UserController.java
    - @PermitAll na POST (rejestracja)
    - @RolesAllowed("ADMIN") na GET/DELETE
    - Automatyczne ustawienie roli USER przy rejestracji

âœï¸  NoteRepository.java
    - Dodano findByFigureIdAndOwner() - filtrowanie w bazie

âœï¸  NoteService.java
    - Dodano findByFigureIdAndOwner()

âœï¸  requests.http
    - Dodano Basic Auth do wszystkich requestÃ³w
    - Dodano sekcjÄ™ testÃ³w autoryzacji (13 testÃ³w)

âœï¸  README.md
    - Dodano sekcjÄ™ "Security & Authorization"

===========================================
UÅ»YTKOWNICY TESTOWI:
===========================================

ADMIN:
------
Login:    admin
Password: admin123
Role:     ADMIN
UUID:     fe003ce8-0dae-46cb-8d01-104d1d91d4a0

USER #1 (test):
---------------
Login:    test
Password: password123
Role:     USER

USER #2 (olaf):
---------------
Login:    olaf
Password: password123
Role:     USER

===========================================
UPRAWNIENIA (MATRIX):
===========================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZasÃ³b / Operacja        â”‚  USER  â”‚ ADMIN  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GET /figures            â”‚   âœ…   â”‚   âœ…   â”‚
â”‚ POST /figures           â”‚   âŒ   â”‚   âœ…   â”‚
â”‚ PUT /figures/{id}       â”‚   âŒ   â”‚   âœ…   â”‚
â”‚ DELETE /figures/{id}    â”‚   âŒ   â”‚   âœ…   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GET /notes (all)        â”‚  OWN   â”‚  ALL   â”‚
â”‚ GET /notes/{id}         â”‚  OWN   â”‚  ALL   â”‚
â”‚ POST /notes             â”‚   âœ…   â”‚   âœ…   â”‚
â”‚ PUT /notes/{id}         â”‚  OWN   â”‚  ALL   â”‚
â”‚ DELETE /notes/{id}      â”‚  OWN   â”‚  ALL   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POST /users (register)  â”‚   âœ…   â”‚   âœ…   â”‚
â”‚ GET /users              â”‚   âŒ   â”‚   âœ…   â”‚
â”‚ GET /users/{id}         â”‚   âŒ   â”‚   âœ…   â”‚
â”‚ DELETE /users/{id}      â”‚   âŒ   â”‚   âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OWN = tylko swoje zasoby
ALL = wszystkie zasoby

===========================================
AUTOMATYCZNE FUNKCJE:
===========================================

1. âœ… WÅ‚aÅ›ciciel notatki ustawiany AUTOMATYCZNIE
   - W NoteController.createNoteForFigure()
   - Pobierany z SecurityContext.getUserPrincipal().getName()
   - Nie moÅ¼na podaÄ‡ wÅ‚aÅ›ciciela w JSONie

2. âœ… Filtrowanie na poziomie BAZY DANYCH
   - NoteRepository.findByFigureIdAndOwner()
   - JPQL: WHERE n.createdBy.login = :username
   - Wydajne - baza zwraca tylko odpowiednie rekordy

3. âœ… Automatyczne nadanie roli USER przy rejestracji
   - UserController.registerUser()
   - user.setRole(Role.USER)

4. âœ… Sprawdzanie wÅ‚aÅ›ciciela przy edycji/usuwaniu
   - Filter w Optional: .filter(note -> isAdmin || note.getCreatedBy().getLogin().equals(username))
   - HTTP 403 Forbidden jeÅ›li nie jest wÅ‚aÅ›cicielem

===========================================
TESTOWANIE:
===========================================

W pliku requests.http znajdujÄ… siÄ™ 13 testÃ³w autoryzacji:

TEST 1:  DostÄ™p bez autoryzacji â†’ 401 Unauthorized
TEST 2:  USER dodaje kategoriÄ™ â†’ 403 Forbidden
TEST 3:  ADMIN dodaje kategoriÄ™ â†’ 201 Created
TEST 4:  USER tworzy notatkÄ™ â†’ 201 Created (wÅ‚aÅ›ciciel auto)
TEST 5:  USER edytuje cudzÄ… notatkÄ™ â†’ 403 Forbidden
TEST 6:  ADMIN edytuje dowolnÄ… notatkÄ™ â†’ 200 OK
TEST 7:  USER pobiera notatki â†’ tylko swoje
TEST 8:  ADMIN pobiera notatki â†’ wszystkie
TEST 9:  USER usuwa cudzÄ… notatkÄ™ â†’ 403 Forbidden
TEST 10: ADMIN usuwa dowolnÄ… notatkÄ™ â†’ 204 No Content
TEST 11: Rejestracja bez auth â†’ 201 Created
TEST 12: USER pobiera listÄ™ uÅ¼ytkownikÃ³w â†’ 403 Forbidden
TEST 13: ADMIN pobiera listÄ™ uÅ¼ytkownikÃ³w â†’ 200 OK

===========================================
PRZYKÅADY UÅ»YCIA:
===========================================

1. Basic Auth w HTTP Client (IntelliJ):
   Authorization: Basic admin:admin123
   Authorization: Basic test:password123

2. Curl (Windows):
   curl -X GET "http://localhost:9080/historyapi/api/figures/" ^
     -H "Accept: application/json" ^
     -u admin:admin123

3. PowerShell:
   $headers = @{
       "Authorization" = "Basic " + [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes("admin:admin123"))
   }
   Invoke-RestMethod -Uri "http://localhost:9080/historyapi/api/figures/" -Headers $headers

===========================================
KONFIGURACJA SERWERA:
===========================================

server.xml:
-----------
<feature>appSecurity-5.0</feature>      â† Jakarta Security API
<feature>enterpriseBeans-4.0</feature>   â† EJB (juÅ¼ byÅ‚o)

DatabaseIdentityStore:
----------------------
- @ApplicationScoped
- Implements IdentityStore
- validate(Credential) - sprawdza login/hasÅ‚o z bazy
- Zwraca CredentialValidationResult z rolami

SecurityConfig:
---------------
- @BasicAuthenticationMechanismDefinition(realmName = "history-api-realm")
- WÅ‚Ä…cza Basic Auth dla caÅ‚ej aplikacji

===========================================
UWAGI IMPLEMENTACYJNE:
===========================================

1. âš ï¸  HASÅA W PLAINTEXT
   W produkcji naleÅ¼y uÅ¼yÄ‡ BCrypt/PBKDF2:
   - password_hash zamiast password
   - BCryptPasswordEncoder
   - @Inject PasswordHasher

2. âœ… FILTROWANIE W BAZIE DANYCH
   Zamiast:
     findAll().stream().filter(...)
   UÅ¼ywamy:
     JPQL: SELECT n FROM Note n WHERE n.createdBy.login = :username

3. âœ… SECURITY CONTEXT
   @Context SecurityContext securityContext
   - getUserPrincipal().getName() - username
   - isUserInRole("ADMIN") - sprawdzenie roli

4. âœ… RESPONSE CODES
   - 401 Unauthorized - brak autoryzacji
   - 403 Forbidden - brak uprawnieÅ„
   - 404 Not Found - zasÃ³b nie istnieje
   - 201 Created - utworzono

===========================================
SPRAWDZENIE POPRAWNOÅšCI:
===========================================

âœ… Konfiguracja domeny bezpieczeÅ„stwa:
   - DatabaseIdentityStore z bazÄ… danych âœ“
   - Basic Authentication âœ“

âœ… Autoryzacja kategorii (HistoricalFigure):
   - Tylko ADMIN moÅ¼e dodawaÄ‡ âœ“
   - Tylko ADMIN moÅ¼e usuwaÄ‡ âœ“
   - KaÅ¼dy moÅ¼e pobieraÄ‡ âœ“

âœ… Autoryzacja elementÃ³w (Note):
   - ADMIN moÅ¼e pobraÄ‡ wszystkie âœ“
   - USER moÅ¼e pobraÄ‡ tylko swoje (JPQL) âœ“
   - ADMIN moÅ¼e edytowaÄ‡/usuwaÄ‡ wszystkie âœ“
   - USER moÅ¼e edytowaÄ‡/usuwaÄ‡ tylko swoje âœ“
   - USER moÅ¼e dodawaÄ‡, wÅ‚aÅ›ciciel auto âœ“

âœ… Rejestracja uÅ¼ytkownikÃ³w:
   - KaÅ¼dy moÅ¼e siÄ™ zarejestrowaÄ‡ âœ“
   - DomyÅ›lna rola USER âœ“

===========================================
GOTOWE DO TESTOWANIA!
===========================================

Uruchom serwer i przetestuj wszystkie endpointy z requests.http.
ZwrÃ³Ä‡ szczegÃ³lnÄ… uwagÄ™ na sekcjÄ™ "Lab 6: Testy Autoryzacji".

Wszystkie wymagania z Lab 6 zostaÅ‚y zrealizowane! ğŸ‰

