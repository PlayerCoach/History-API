<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:f="jakarta.faces.core"
                template="/WEB-INF/template/main.xhtml">

    <f:metadata>
        <f:viewParam name="noteId" value="#{noteEditView.noteId}" />
        <f:viewParam name="figureId" value="#{noteEditView.figureId}" />

        <f:viewAction action="#{noteEditView.loadData}" />
    </f:metadata>

    <ui:define name="title">#{noteEditView.noteId == null ? msg['notes.edit.title.new'] : msg['notes.edit.title.edit']}</ui:define>

    <ui:define name="content">
        <h2>#{noteEditView.noteId == null ? msg['notes.edit.title.new'] : msg['notes.edit.title.edit']}</h2>
        <hr/>

        <h:panelGroup rendered="#{noteEditView.note != null}">
            <h:form id="noteForm" styleClass="col-md-6">

                <div class="form-outline mb-4">
                    <h:inputText id="title" value="#{noteEditView.note.title}" styleClass="form-control"
                                 required="true"
                                 requiredMessage="#{msg['notes.edit.required.title']}" />
                    <h:outputLabel for="title" styleClass="form-label">#{msg['notes.edit.field.title']}</h:outputLabel>
                    <h:message for="title" styleClass="text-danger" />
                </div>

                <div class="form-outline mb-4">
                    <h:inputTextarea id="content" value="#{noteEditView.note.content}" styleClass="form-control" rows="5"
                                     required="true"
                                     requiredMessage="#{msg['notes.edit.required.content']}" />
                    <h:outputLabel for="content" styleClass="form-label">#{msg['notes.edit.field.content']}</h:outputLabel>
                    <h:message for="content" styleClass="text-danger" />
                </div>

                <div class="mb-4">
                    <label for="mode" class="form-label">#{msg['notes.edit.field.mode']}</label>
                    <h:selectOneMenu id="mode" value="#{noteEditView.note.mode}" styleClass="form-select">
                        <f:selectItems value="#{noteEditView.modes}" var="m"
                                       itemLabel="#{m.name()}" itemValue="#{m}" />
                    </h:selectOneMenu>
                </div>

                <div class="mb-4">
                    <label for="figureSelect" class="form-label">#{msg['notes.edit.field.figure']}</label>
                    <h:selectOneMenu id="figureSelect"
                                     value="#{noteEditView.note.historicalFigure}"
                                     styleClass="form-select" required="true"
                                     converter="historicalFigureConverter">
                        <f:facet name="prompt">#{msg['notes.edit.field.figure.prompt']}</f:facet>
                        <f:selectItems value="#{noteEditView.availableFigures}"
                                       var="fig"
                                       itemLabel="#{fig.name}"
                                       itemValue="#{fig}" />
                    </h:selectOneMenu>
                </div>

                <h:commandButton value="#{msg['notes.edit.action.save']}" action="#{noteEditView.save}" styleClass="btn btn-primary" />

                <h:link outcome="/note/notes" value="#{msg['notes.edit.action.cancel']}" styleClass="btn btn-link" />

            </h:form>
        </h:panelGroup>

        <h:panelGroup rendered="#{noteEditView.note == null and noteEditView.noteId != null}">
            <div class="alert alert-danger" role="alert">
                #{msg['notes.edit.notFound']}
            </div>
        </h:panelGroup>

    </ui:define>
</ui:composition>